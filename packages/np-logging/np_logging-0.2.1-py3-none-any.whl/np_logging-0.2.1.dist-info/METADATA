Metadata-Version: 2.1
Name: np-logging
Version: 0.2.1
Summary: Pre-configured file, web, and email logging for Mindscope neuropixels projects, repackaging code from AIBS mpeconfig.
Author: Ben Hardcastle
Author-email: ben.hardcastle@alleninstitute.org
Maintainer: Ben Hardcastle
Maintainer-email: ben.hardcastle@alleninstitute.org
Requires-Python: >=3.6,<4.0
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.6
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Requires-Dist: np_config (>=0.1,<0.2)
Project-URL: Bug Tracker, https://github.com/alleninstitute/np_logging/issues
Project-URL: Repository, https://github.com/alleninstitute/np_logging
Description-Content-Type: text/markdown

**For use on internal Allen Institute network**

```
import logging
import np_logging
```

`np_logging.setup()` runs automatically on import to add handlers and loggers from a default config,
then the built-in python `logging` module can be used as normal.

The default config provides the loggers `web` and `email`, in addition to the default
`root` which includes file handlers for `logging.INFO` and `logging.DEBUG`  levels, plus
console logging. 

Usage example:
```
logging.getLogger('web').info('test: web server')
logging.getLogger('email').info('test: email logger')
logging.debug('test: root logger')
```

By default, a message is logged reporting the
      elapsed time and cause of termination. If an exception was raised, the
      traceback is included.


- user configs can be specified according to the python logging [library dict schema](https://docs.python.org/3/library/logging.config.html#logging-config-dictschema)

- the default config is fetched from the
ZooKeeper server `eng-mindscope:2181`
- configs can be added via ZooNavigator webview:
  [http://eng-mindscope:8081](http://eng-mindscope:8081)
- or more conveniently, via an extension for VSCode such as [gaoliang.visual-zookeeper](https://marketplace.visualstudio.com/items?itemName=gaoliang.visual-zookeeper)

ZooKeeper configs can be fetched via their path:
```
test_config: dict = np_logging.fetch_zk_config(
    '/projects/np_logging_test/defaults/logging'
)
```

If the package can't connect to ZooKeeper, it will alert the user and fall back to a
file containing a default logging dict.

Once a logging config dict has been modified as necessary...
```
test_config['handlers']['email_handler']['toaddrs'] = username@alleninstitute.org
```
re-run the logging setup with the new config dict:
```
np_logging.setup(
    config: dict = test_config,
    project_name = 'test',
)
```

- `project_name` should be supplied to use the web logger - if unspecified, the name of the
  current working directory is used
- the web log can be viewed at [http://eng-mindscope:8080](http://eng-mindscope:8080)



Other input arguments to `np_logging.setup()`:
- `log_at_exit` (default `True`)

    - If `True`, a message is logged when the program terminates, reporting total
      elapsed time.

- `email_at_exit` (default `False`)

    - If `True`, an email is sent when the program terminates, reporting the
      elapsed time and cause of termination. If an exception was raised, the
      traceback is included.
      
    - If `logging.error`, the email is only sent if the program terminates via an exception.


