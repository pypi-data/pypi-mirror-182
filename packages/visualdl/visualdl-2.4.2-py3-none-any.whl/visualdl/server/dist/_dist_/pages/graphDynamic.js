import y,{AsideSection as a}from"../components/Aside.js";import Se from"../components/GraphPage/GraphDynamic.js";import e,{useCallback as s,useEffect as X,useMemo as F,useRef as Y,useState as r}from"../../__snowpack__/pkg/react.js";import Ce from"../components/Select.js";import{actions as ke,selectors as we}from"../store/index.js";import{rem as E}from"../utils/style.js";import{useDispatch as je,useSelector as De}from"../../__snowpack__/pkg/react-redux.js";import xe from"../components/Check.js";import N from"../components/Button.js";import S from"../components/Checkbox.js";import be from"../components/Content.js";import c from"../components/Field.js";import ve from"../components/GraphPage/ModelPropertiesDialog.js";import Ge from"../components/GraphPage/NodeDocumentationSidebar.js";import _e from"../components/GraphPage/NodePropertiesSidebar.js";import Z from"../components/RadioButton.js";import ye from"../components/RadioGroup.js";import Fe from"../components/GraphPage/Search.js";import Ne from"../components/Title.js";import Pe from"../components/GraphPage/Uploader.js";import C from"../../__snowpack__/pkg/styled-components.js";import{fetcher as ee}from"../utils/fetch.js";import{useTranslation as Re}from"../../__snowpack__/pkg/react-i18next.js";const te=C(N)`
    width: 100%;
`,Me=C(Ce)`
    width: 100%;
`,Ie=C.div`
    display: flex;
    justify-content: space-between;

    > * {
        flex: 1 1 auto;

        &:not(:last-child) {
            margin-right: ${E(20)};
        }
    }
`,ze=C(a)`
    max-height: calc(100% - ${E(40)});
    display: flex;
    flex-direction: column;

    &:not(:last-child) {
        padding-bottom: 0;
    }
`,Ae=()=>{const{t:o}=Re(["graph","common"]),P=je(),ne=De(we.graph.model),l=Y(null),i=Y(null),[R,oe]=r(ne),[k,M]=r(0),[m,re]=r(),[w,I]=r(""),[z,le]=r(!1),A=s(t=>{P(ke.graph.setModel(t)),oe(t)},[P]),p=s(()=>{i.current&&(i.current.value="",i.current.click())},[]),ae=t=>{const n=t.target;if(n.files[0].name.split(".")[1]!=="pdmodel"){alert("\u8BE5\u9875\u9762\u53EA\u80FD\u89E3\u6790paddle\u7684\u6A21\u578B,\u5982\u9700\u89E3\u6790\u8BF7\u8DF3\u8F6C\u7F51\u7EDC\u7ED3\u6784\u9759\u6001\u56FE\u9875\u9762");return}n&&n.files&&n.files.length&&se(n.files)},se=t=>{const n=new FormData;n.append("file",t[0]),n.append("filename",t[0].name),ee("/graph/upload",{method:"POST",body:n}).then(G=>{const _=k+1;M(_)},G=>{const _=k+1;M(_)})},[j,ce]=r([]),[B,T]=r(""),ie=s(t=>{ce(t.graphs),T(t.selected||"")},[]),U=s(t=>{var n;T(t),(n=l.current)==null||n.changeGraph(t)},[]),[O,D]=r(""),[d,W]=r(!1),[K,$]=r({text:"",result:[]}),H=s(t=>{var n;D(t),(n=l.current)==null||n.search(t)},[]),q=s(t=>{var n;D(t.name),(n=l.current)==null||n.select(t)},[]),[h,me]=r(!1),[u,pe]=r(!0),[g,de]=r(!1),[x,he]=r(!1),[ue,J]=r(null),[f,L]=r(null),[b,v]=r(null);X(()=>{ee("/graph_runs").then(t=>{const n=t;re(n),I(n[0])})},[k]),X(()=>{D(""),$({text:"",result:[]})},[R,h,u,g]);const Q=F(()=>d?null:e.createElement(te,{type:"primary",rounded:!0,onClick:p},o("graph:change-model")),[o,p,d]),[V,ge]=r(!1),fe=F(()=>V?b?e.createElement(y,{width:E(360)},e.createElement(Ge,{data:b,onClose:()=>v(null)})):f?e.createElement(y,{width:E(360)},e.createElement(_e,{data:f,onClose:()=>L(null),showNodeDocumentation:()=>{var t;return(t=l.current)==null?void 0:t.showNodeDocumentation(f)}})):e.createElement(y,{bottom:Q},e.createElement(ze,null,e.createElement(Fe,{text:O,data:K,onChange:H,onSelect:q,onActive:()=>W(!0),onDeactive:()=>W(!1)})),!d&&e.createElement(e.Fragment,null,e.createElement(a,null,e.createElement(te,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.showModelProperties()}},o("graph:model-properties"))),j.length>1&&e.createElement(a,null,e.createElement(c,{label:o("graph:subgraph")},e.createElement(Me,{list:j,value:B,onChange:U}))),e.createElement(a,null,e.createElement(c,{label:o("graph:display-data")},e.createElement("div",null,e.createElement(S,{checked:h,onChange:me},o("graph:show-attributes"))),e.createElement("div",null,e.createElement(S,{checked:u,onChange:pe},o("graph:show-initializers"))),e.createElement("div",null,e.createElement(S,{checked:g,onChange:de},o("graph:show-node-names"))),e.createElement("div",null,e.createElement(S,{checked:z,onChange:le},o("graph:keep-expanded"))))),e.createElement(a,null,e.createElement(c,{label:o("graph:direction")},e.createElement(ye,{value:x,onChange:he},e.createElement(Z,{value:!1},o("graph:vertical")),e.createElement(Z,{value:!0},o("graph:horizontal"))))),e.createElement(a,null,e.createElement(c,{label:o("graph:export-file")},e.createElement(Ie,null,e.createElement(N,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.export("png")}},o("graph:export-png")),e.createElement(N,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.export("svg")}},o("graph:export-svg"))))),e.createElement(a,null,e.createElement(c,{label:o("graph:Choose-model")},e.createElement("div",{className:"run-list"},m&&m.map((t,n)=>e.createElement("div",{key:n},e.createElement(xe,{checked:w===t,value:t,title:t,onChange:G=>{I(t)}},e.createElement("span",{className:"run-item"},t.split("/")[t.split("/").length-1]))))))))):null,[o,Q,O,m,d,K,w,j,B,U,H,q,h,u,g,x,V,f,b]),Ee=F(()=>e.createElement(Pe,{onClickUpload:p,onDropFiles:A}),[p,A]);return e.createElement(e.Fragment,null,e.createElement(Ne,null,o("common:graph")),e.createElement(ve,{data:ue,onClose:()=>J(null)}),e.createElement(be,{aside:fe},e.createElement(Se,{ref:l,files:R,uploader:Ee,showAttributes:h,showInitializers:u,showNames:g,isKeepData:z,horizontal:x,selectedRuns:w,onRendered:()=>ge(!0),onOpened:ie,onSearch:t=>$(t),onShowModelProperties:t=>J(t),runs:m,onShowNodeProperties:t=>{L(t),v(null)},onShowNodeDocumentation:t=>v(t)}),e.createElement("input",{ref:i,type:"file",multiple:!1,onChange:ae,style:{display:"none"}})))};export default Ae;
