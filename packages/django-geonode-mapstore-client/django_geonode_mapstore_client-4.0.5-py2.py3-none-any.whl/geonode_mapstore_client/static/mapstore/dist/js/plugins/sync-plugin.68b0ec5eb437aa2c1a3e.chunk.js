(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[67440],{535188:(t,e,r)=>{"use strict";r.r(e),r.d(e,{ConnectedSyncButton:()=>U,default:()=>Z});var n=r(124852),o=r.n(n),i=r(675263),a=r.n(i),u=r(171703),c=r(22222),l=r(322843),s=r(805346),f=r(693473),p=r(274621),y=r(49977),v=r(375875),b=r.n(v),d=r(682492),m=r.n(d),g="GEONODE:SYNC_RESOURCES",O=r(73443),h=r(903828),S=r(799380),j=r(134990),w=r(197395),P=r(535721),E=r(367306),k=r(555927);function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function T(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function z(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?T(Object(r),!0).forEach((function(e){A(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function A(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==D(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==D(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===D(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var _={map:S.nl,image:S.ez,video:S.ez},x=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n="",o={};if("geostory"===t)o="map"!==(n=e.subtype||e.resource_type)?(0,P.R1)(e,e):(0,P.F0)(e);else if("dashboard"===t){var i,a=null===(i=e.widgets)||void 0===i?void 0:i.map((function(t){var e=r.find((function(e){var r,n;return!(e.data.pk!==(null===(r=t.map)||void 0===r||null===(n=r.extraParams)||void 0===n?void 0:n.pk))}));return e?z(z({},t),{},{map:z(z({},t.map),e.data.data.map)}):t}));o=m()(e,{widgets:a})}return{type:n,data:o}};const R={gnSyncComponentsWithResources:function(t,e){return t.ofType(g).switchMap((function(){var t=e.getState(),r=(0,h.L4)(t),n=function(t,e){switch(t){case"geostory":return(0,h._i)(e);case"dashboard":return(0,h.F7)(e);default:return[]}}(r,t);return y.Observable.defer((function(){return b().all(n.map((function(t){var e,n;return("geostory"===r?_[t.type](t.id):(0,S.nl)(null==t||null===(e=t.map)||void 0===e||null===(n=e.extraParams)||void 0===n?void 0:n.pk)).then((function(t){return{data:t,status:"success",title:t.title}})).catch((function(){var e,r,n,o;return{data:t,status:"error",title:(null==t||null===(e=t.data)||void 0===e?void 0:e.title)||(null==t||null===(r=t.map)||void 0===r||null===(n=r.extraParams)||void 0===n?void 0:n.pk)||(null==t||null===(o=t.data)||void 0===o?void 0:o.name)}}))})))})).switchMap((function(e){var n,o,i,a=e.filter((function(t){return"error"===t.status})),u=e.filter((function(t){return"success"===t.status})),c=function(){if(0===u.length)return[];if("geostory"===r)return u.map((function(t){var e=t.data,r=x("geostory",e),n=r.type,o=r.data;return(0,j.zJ)(e.pk,n,o)}));if("dashboard"===r){var e=(0,E.hS)(t),n=x("dashboard",e,u).data;return[(0,k.rR)((0,E.NB)(t),n)]}return[]}(),l=function(t,e,r){var n="Success";return t>0&&e>0?n="Warning":0===t&&e>0?n="Success":t>0&&0===e&&(n="Error"),{level:n.toLowerCase(),title:"gnviewer.sync".concat(n).concat("Warning"!==n?r:"","Title"),message:"gnviewer.sync".concat(n,"Message")}}(a.length,u.length,r),s=l.level,f=l.title,p=l.message;return y.Observable.of.apply(y.Observable,(i=c,function(t){if(Array.isArray(t))return C(t)}(i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||function(t,e){if(t){if("string"==typeof t)return C(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(t,e):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([(0,O.gc)(),(0,w.$Z)({title:f,message:p,values:{successTitles:null===(n=u.map((function(t){return t.title})))||void 0===n?void 0:n.join(", "),errorTitles:null===(o=a.map((function(t){return t.title})))||void 0===o?void 0:o.join(", ")}},s)]))})).catch((function(t){var e,r;return y.Observable.of((0,O.gc)(),(0,w.vU)({title:"gnviewer.syncErrorTitle",message:(null==t||null===(e=t.data)||void 0===e?void 0:e.detail)||(null==t||null===(r=t.originalError)||void 0===r?void 0:r.message)||(null==t?void 0:t.message)||"gnviewer.syncErrorDefault"}))})).startWith((0,O.id)())}))}};function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function M(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function N(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==I(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===I(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function W(t){var e=t.synchronize,r=t.enabled,n=t.size;return r&&o().createElement(f.Z,{variant:"primary",size:n,onClick:function(){return e()}},o().createElement(s.Z,{msgId:"gnviewer.sync"}))}W.contextTypes={synchronize:a().func};var U=(0,u.connect)((0,c.P1)(p.jl,(function(t){return{enabled:t}})),{synchronize:function(){return{type:g}}})(W);const Z=(0,l.rx)("Sync",{component:U,containers:{ActionNavbar:{name:"Sync",priority:1}},epics:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?M(Object(r),!0).forEach((function(e){N(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},R),reducers:{}})}}]);