import{m as T,a as C,u as _,b as g,_ as h,o as a,c,d as m,V as L,e as p,f as n,w as t,g as y,h as B,i as f,j as o,t as d,F as I,r as V,k as b,l as $,n as k,p as S,q as O,s as w,v as M,x as F,y as N,z as D,A as P,B as j,C as z,D as E,E as x,G}from"./admin-2fc1fcfb.js";const U={name:"AdminStatusList",data(){return{mdiCloseCircleOutline:T}},computed:{...C(_,{librarianStatuses:e=>e.librarianStatuses,show:e=>e.librarianStatuses.length>0})},created(){this.load()},methods:{...g(_,["loadTable","librarianTask"]),indeterminate:e=>!e.preactive&&+e.total==0,progress(e){return e.preactive||+e.total==0?0:100*+e.complete/+e.total},load(){this.loadTable("LibrarianStatus")},clear(){this.librarianTask("librarian_clear_status","")}}},q=e=>(O("data-v-89ffc8fa"),e=e(),w(),e),R={key:0},W=q(()=>b("h4",null,"Librarian Tasks",-1)),H={nav:"",class:"statusItem"},J={class:"statusItemTitle"},K={key:0};function Q(e,r,i,v,u,l){return a(),c(I,null,[e.show?(a(),m(L,{key:0})):p("",!0),n(S,{onClick:l.load},{default:t(()=>[n(y,null,{default:t(()=>[e.show?(a(),c("div",R,[n(B,{id:"clearButton",size:"small",icon:"",title:"Clear Librarian Statuses",onClick:l.clear},{default:t(()=>[n(f,null,{default:t(()=>[o(d(u.mdiCloseCircleOutline),1)]),_:1})]),_:1},8,["onClick"]),W,(a(!0),c(I,null,V(e.librarianStatuses,s=>(a(),m(y,{key:`${s.type} ${s.name}`},{default:t(()=>[b("div",H,[b("div",J,[o(d(s.type)+" "+d(s.name)+" ",1),+s.total?(a(),c("span",K,d(s.complete)+"/"+d(s.total),1)):p("",!0)]),n($,{indeterminate:l.indeterminate(s),"model-value":l.progress(s),bottom:""},null,8,["indeterminate","model-value"])])]),_:2},1024))),128))])):(a(),m(k,{key:1,id:"noTasksRunning"},{default:t(()=>[o(" No librarian tasks running ")]),_:1}))]),_:1})]),_:1},8,["onClick"])],64)}const X=h(U,[["render",Q],["__scopeId","data-v-89ffc8fa"]]);const Y={name:"AdminMenu",components:{AdminStatusList:X},props:{menu:{type:Boolean,default:!0}},data(){return{mdiBookAlert:M,mdiOpenInNew:F,mdiDatabaseClockOutline:N,mdiCogOutline:D}},computed:{...P(j,["isUserAdmin"]),...z(_,{unseenFailedImports:e=>e.unseenFailedImports})},methods:{...g(_,["clearFailedImports","librarianTask"])}},Z={key:0},ee={key:0};function te(e,r,i,v,u,l){const s=E("AdminStatusList");return e.isUserAdmin?(a(),c("div",Z,[i.menu?(a(),c("div",ee,[n(S,{onClick:r[0]||(r[0]=A=>e.librarianTask("poll"))},{default:t(()=>[n(k,null,{default:t(()=>[n(f,null,{default:t(()=>[o(d(u.mdiDatabaseClockOutline),1)]),_:1}),o("Poll All Libraries")]),_:1})]),_:1}),n(S,{to:{name:"admin"},onClick:r[1]||(r[1]=A=>e.unseenFailedImports=!1)},{default:t(()=>[n(k,null,{default:t(()=>[n(f,null,{default:t(()=>[o(d(u.mdiCogOutline),1)]),_:1}),o("Admin Panel "),e.unseenFailedImports?(a(),m(f,{key:0,id:"failedImportsIcon",title:"New Failed Imports"},{default:t(()=>[o(d(u.mdiBookAlert),1)]),_:1})):p("",!0)]),_:1})]),_:1})])):p("",!0),n(s)])):p("",!0)}const ae=h(Y,[["render",te],["__scopeId","data-v-5a4646ff"]]),le=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"})),ne={name:"AdminSettingsDrawerButtonIcon",data(){return{mdiMenu:x}},computed:{...C(_,{librarianStatuses:e=>e.librarianStatuses}),progressEnabled:function(){return this.librarianStatuses.length>0},progress:function(){let e=0,r=0;if(!(!this.librarianStatuses||this.librarianStatuses.length===0)){for(const i of this.librarianStatuses){if(i.total===null||i.total===void 0||i.complete===void 0)return;e+=+i.complete,r+=+i.total}if(!(r<=0))return 100*e/r}}},created(){this.loadTable("LibrarianStatus")},methods:{...g(_,["loadTable"])}};function se(e,r,i,v,u,l){return a(),c("span",null,[l.progressEnabled?(a(),m(G,{key:1,indeterminate:l.progress==null,"model-value":l.progress,size:"32","aria-label":"`Librarian tasks in progress ${Math.round(progress)}%`"},null,8,["indeterminate","model-value"])):(a(),m(f,{key:0},{default:t(()=>[o(d(u.mdiMenu),1)]),_:1}))])}const re=h(ne,[["render",se]]),oe=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{le as a,oe as b};
