"use strict";
(self["webpackChunk_jupyterlab_application_top"] = self["webpackChunk_jupyterlab_application_top"] || []).push([["vendors-node_modules_codemirror_legacy-modes_mode_textile_js"],{

/***/ "../../node_modules/@codemirror/legacy-modes/mode/textile.js":
/*!*******************************************************************!*\
  !*** ../../node_modules/@codemirror/legacy-modes/mode/textile.js ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "textile": () => (/* binding */ textile)
/* harmony export */ });
var TOKEN_STYLES = {
  addition: "inserted",
  attributes: "propertyName",
  bold: "strong",
  cite: "keyword",
  code: "monospace",
  definitionList: "list",
  deletion: "deleted",
  div: "punctuation",
  em: "emphasis",
  footnote: "variable",
  footCite: "qualifier",
  header: "heading",
  html: "comment",
  image: "atom",
  italic: "emphasis",
  link: "link",
  linkDefinition: "link",
  list1: "list",
  list2: "list.special",
  list3: "list",
  notextile: "string.special",
  pre: "operator",
  p: "content",
  quote: "bracket",
  span: "quote",
  specialChar: "character",
  strong: "strong",
  sub: "content.special",
  sup: "content.special",
  table: "variableName.special",
  tableHeading: "operator"
};

function startNewLine(stream, state) {
  state.mode = Modes.newLayout;
  state.tableHeading = false;

  if (state.layoutType === "definitionList" && state.spanningLayout &&
      stream.match(RE("definitionListEnd"), false))
    state.spanningLayout = false;
}

function handlePhraseModifier(stream, state, ch) {
  if (ch === "_") {
    if (stream.eat("_"))
      return togglePhraseModifier(stream, state, "italic", /__/, 2);
    else
      return togglePhraseModifier(stream, state, "em", /_/, 1);
  }

  if (ch === "*") {
    if (stream.eat("*")) {
      return togglePhraseModifier(stream, state, "bold", /\*\*/, 2);
    }
    return togglePhraseModifier(stream, state, "strong", /\*/, 1);
  }

  if (ch === "[") {
    if (stream.match(/\d+\]/)) state.footCite = true;
    return tokenStyles(state);
  }

  if (ch === "(") {
    var spec = stream.match(/^(r|tm|c)\)/);
    if (spec)
      return TOKEN_STYLES.specialChar
  }

  if (ch === "<" && stream.match(/(\w+)[^>]+>[^<]+<\/\1>/))
    return TOKEN_STYLES.html

  if (ch === "?" && stream.eat("?"))
    return togglePhraseModifier(stream, state, "cite", /\?\?/, 2);

  if (ch === "=" && stream.eat("="))
    return togglePhraseModifier(stream, state, "notextile", /==/, 2);

  if (ch === "-" && !stream.eat("-"))
    return togglePhraseModifier(stream, state, "deletion", /-/, 1);

  if (ch === "+")
    return togglePhraseModifier(stream, state, "addition", /\+/, 1);

  if (ch === "~")
    return togglePhraseModifier(stream, state, "sub", /~/, 1);

  if (ch === "^")
    return togglePhraseModifier(stream, state, "sup", /\^/, 1);

  if (ch === "%")
    return togglePhraseModifier(stream, state, "span", /%/, 1);

  if (ch === "@")
    return togglePhraseModifier(stream, state, "code", /@/, 1);

  if (ch === "!") {
    var type = togglePhraseModifier(stream, state, "image", /(?:\([^\)]+\))?!/, 1);
    stream.match(/^:\S+/); // optional Url portion
    return type;
  }
  return tokenStyles(state);
}

function togglePhraseModifier(stream, state, phraseModifier, closeRE, openSize) {
  var charBefore = stream.pos > openSize ? stream.string.charAt(stream.pos - openSize - 1) : null;
  var charAfter = stream.peek();
  if (state[phraseModifier]) {
    if ((!charAfter || /\W/.test(charAfter)) && charBefore && /\S/.test(charBefore)) {
      var type = tokenStyles(state);
      state[phraseModifier] = false;
      return type;
    }
  } else if ((!charBefore || /\W/.test(charBefore)) && charAfter && /\S/.test(charAfter) &&
             stream.match(new RegExp("^.*\\S" + closeRE.source + "(?:\\W|$)"), false)) {
    state[phraseModifier] = true;
    state.mode = Modes.attributes;
  }
  return tokenStyles(state);
};

function tokenStyles(state) {
  var disabled = textileDisabled(state);
  if (disabled) return disabled;

  var styles = [];
  if (state.layoutType) styles.push(TOKEN_STYLES[state.layoutType]);

  styles = styles.concat(activeStyles(
    state, "addition", "bold", "cite", "code", "deletion", "em", "footCite",
    "image", "italic", "link", "span", "strong", "sub", "sup", "table", "tableHeading"));

  if (state.layoutType === "header")
    styles.push(TOKEN_STYLES.header + "-" + state.header);

  return styles.length ? styles.join(" ") : null;
}

function textileDisabled(state) {
  var type = state.layoutType;

  switch(type) {
  case "notextile":
  case "code":
  case "pre":
    return TOKEN_STYLES[type];
  default:
    if (state.notextile)
      return TOKEN_STYLES.notextile + (type ? (" " + TOKEN_STYLES[type]) : "");
    return null;
  }
}

function activeStyles(state) {
  var styles = [];
  for (var i = 1; i < arguments.length; ++i) {
    if (state[arguments[i]])
      styles.push(TOKEN_STYLES[arguments[i]]);
  }
  return styles;
}

function blankLine(state) {
  var spanningLayout = state.spanningLayout, type = state.layoutType;

  for (var key in state) if (state.hasOwnProperty(key))
    delete state[key];

  state.mode = Modes.newLayout;
  if (spanningLayout) {
    state.layoutType = type;
    state.spanningLayout = true;
  }
}

var REs = {
  cache: {},
  single: {
    bc: "bc",
    bq: "bq",
    definitionList: /- .*?:=+/,
    definitionListEnd: /.*=:\s*$/,
    div: "div",
    drawTable: /\|.*\|/,
    foot: /fn\d+/,
    header: /h[1-6]/,
    html: /\s*<(?:\/)?(\w+)(?:[^>]+)?>(?:[^<]+<\/\1>)?/,
    link: /[^"]+":\S/,
    linkDefinition: /\[[^\s\]]+\]\S+/,
    list: /(?:#+|\*+)/,
    notextile: "notextile",
    para: "p",
    pre: "pre",
    table: "table",
    tableCellAttributes: /[\/\\]\d+/,
    tableHeading: /\|_\./,
    tableText: /[^"_\*\[\(\?\+~\^%@|-]+/,
    text: /[^!"_=\*\[\(<\?\+~\^%@-]+/
  },
  attributes: {
    align: /(?:<>|<|>|=)/,
    selector: /\([^\(][^\)]+\)/,
    lang: /\[[^\[\]]+\]/,
    pad: /(?:\(+|\)+){1,2}/,
    css: /\{[^\}]+\}/
  },
  createRe: function(name) {
    switch (name) {
    case "drawTable":
      return REs.makeRe("^", REs.single.drawTable, "$");
    case "html":
      return REs.makeRe("^", REs.single.html, "(?:", REs.single.html, ")*", "$");
    case "linkDefinition":
      return REs.makeRe("^", REs.single.linkDefinition, "$");
    case "listLayout":
      return REs.makeRe("^", REs.single.list, RE("allAttributes"), "*\\s+");
    case "tableCellAttributes":
      return REs.makeRe("^", REs.choiceRe(REs.single.tableCellAttributes,
                                          RE("allAttributes")), "+\\.");
    case "type":
      return REs.makeRe("^", RE("allTypes"));
    case "typeLayout":
      return REs.makeRe("^", RE("allTypes"), RE("allAttributes"),
                        "*\\.\\.?", "(\\s+|$)");
    case "attributes":
      return REs.makeRe("^", RE("allAttributes"), "+");

    case "allTypes":
      return REs.choiceRe(REs.single.div, REs.single.foot,
                          REs.single.header, REs.single.bc, REs.single.bq,
                          REs.single.notextile, REs.single.pre, REs.single.table,
                          REs.single.para);

    case "allAttributes":
      return REs.choiceRe(REs.attributes.selector, REs.attributes.css,
                          REs.attributes.lang, REs.attributes.align, REs.attributes.pad);

    default:
      return REs.makeRe("^", REs.single[name]);
    }
  },
  makeRe: function() {
    var pattern = "";
    for (var i = 0; i < arguments.length; ++i) {
      var arg = arguments[i];
      pattern += (typeof arg === "string") ? arg : arg.source;
    }
    return new RegExp(pattern);
  },
  choiceRe: function() {
    var parts = [arguments[0]];
    for (var i = 1; i < arguments.length; ++i) {
      parts[i * 2 - 1] = "|";
      parts[i * 2] = arguments[i];
    }

    parts.unshift("(?:");
    parts.push(")");
    return REs.makeRe.apply(null, parts);
  }
};

function RE(name) {
  return (REs.cache[name] || (REs.cache[name] = REs.createRe(name)));
}

var Modes = {
  newLayout: function(stream, state) {
    if (stream.match(RE("typeLayout"), false)) {
      state.spanningLayout = false;
      return (state.mode = Modes.blockType)(stream, state);
    }
    var newMode;
    if (!textileDisabled(state)) {
      if (stream.match(RE("listLayout"), false))
        newMode = Modes.list;
      else if (stream.match(RE("drawTable"), false))
        newMode = Modes.table;
      else if (stream.match(RE("linkDefinition"), false))
        newMode = Modes.linkDefinition;
      else if (stream.match(RE("definitionList")))
        newMode = Modes.definitionList;
      else if (stream.match(RE("html"), false))
        newMode = Modes.html;
    }
    return (state.mode = (newMode || Modes.text))(stream, state);
  },

  blockType: function(stream, state) {
    var match, type;
    state.layoutType = null;

    if (match = stream.match(RE("type")))
      type = match[0];
    else
      return (state.mode = Modes.text)(stream, state);

    if (match = type.match(RE("header"))) {
      state.layoutType = "header";
      state.header = parseInt(match[0][1]);
    } else if (type.match(RE("bq"))) {
      state.layoutType = "quote";
    } else if (type.match(RE("bc"))) {
      state.layoutType = "code";
    } else if (type.match(RE("foot"))) {
      state.layoutType = "footnote";
    } else if (type.match(RE("notextile"))) {
      state.layoutType = "notextile";
    } else if (type.match(RE("pre"))) {
      state.layoutType = "pre";
    } else if (type.match(RE("div"))) {
      state.layoutType = "div";
    } else if (type.match(RE("table"))) {
      state.layoutType = "table";
    }

    state.mode = Modes.attributes;
    return tokenStyles(state);
  },

  text: function(stream, state) {
    if (stream.match(RE("text"))) return tokenStyles(state);

    var ch = stream.next();
    if (ch === '"')
      return (state.mode = Modes.link)(stream, state);
    return handlePhraseModifier(stream, state, ch);
  },

  attributes: function(stream, state) {
    state.mode = Modes.layoutLength;

    if (stream.match(RE("attributes")))
      return TOKEN_STYLES.attributes
    else
      return tokenStyles(state);
  },

  layoutLength: function(stream, state) {
    if (stream.eat(".") && stream.eat("."))
      state.spanningLayout = true;

    state.mode = Modes.text;
    return tokenStyles(state);
  },

  list: function(stream, state) {
    var match = stream.match(RE("list"));
    state.listDepth = match[0].length;
    var listMod = (state.listDepth - 1) % 3;
    if (!listMod)
      state.layoutType = "list1";
    else if (listMod === 1)
      state.layoutType = "list2";
    else
      state.layoutType = "list3";

    state.mode = Modes.attributes;
    return tokenStyles(state);
  },

  link: function(stream, state) {
    state.mode = Modes.text;
    if (stream.match(RE("link"))) {
      stream.match(/\S+/);
      return TOKEN_STYLES.link
    }
    return tokenStyles(state);
  },

  linkDefinition: function(stream) {
    stream.skipToEnd();
    return TOKEN_STYLES.linkDefinition
  },

  definitionList: function(stream, state) {
    stream.match(RE("definitionList"));

    state.layoutType = "definitionList";

    if (stream.match(/\s*$/))
      state.spanningLayout = true;
    else
      state.mode = Modes.attributes;

    return tokenStyles(state);
  },

  html: function(stream) {
    stream.skipToEnd();
    return TOKEN_STYLES.html
  },

  table: function(stream, state) {
    state.layoutType = "table";
    return (state.mode = Modes.tableCell)(stream, state);
  },

  tableCell: function(stream, state) {
    if (stream.match(RE("tableHeading")))
      state.tableHeading = true;
    else
      stream.eat("|");

    state.mode = Modes.tableCellAttributes;
    return tokenStyles(state);
  },

  tableCellAttributes: function(stream, state) {
    state.mode = Modes.tableText;

    if (stream.match(RE("tableCellAttributes")))
      return TOKEN_STYLES.attributes
    else
      return tokenStyles(state);
  },

  tableText: function(stream, state) {
    if (stream.match(RE("tableText")))
      return tokenStyles(state);

    if (stream.peek() === "|") { // end of cell
      state.mode = Modes.tableCell;
      return tokenStyles(state);
    }
    return handlePhraseModifier(stream, state, stream.next());
  }
};

const textile = {
  startState: function() {
    return { mode: Modes.newLayout };
  },
  token: function(stream, state) {
    if (stream.sol()) startNewLine(stream, state);
    return state.mode(stream, state);
  },
  blankLine: blankLine
};


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfY29kZW1pcnJvcl9sZWdhY3ktbW9kZXNfbW9kZV90ZXh0aWxlX2pzLmY4Yzc1NDYwNDVkZTlkYmZjZmEwLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWtCLHNCQUFzQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLElBQUk7QUFDMUIsWUFBWSxJQUFJLElBQUk7QUFDcEIsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVPO0FBQ1A7QUFDQSxhQUFhO0FBQ2IsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGp1cHl0ZXJsYWIvYXBwbGljYXRpb24tdG9wLy4uLy4uL25vZGVfbW9kdWxlcy9AY29kZW1pcnJvci9sZWdhY3ktbW9kZXMvbW9kZS90ZXh0aWxlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBUT0tFTl9TVFlMRVMgPSB7XG4gIGFkZGl0aW9uOiBcImluc2VydGVkXCIsXG4gIGF0dHJpYnV0ZXM6IFwicHJvcGVydHlOYW1lXCIsXG4gIGJvbGQ6IFwic3Ryb25nXCIsXG4gIGNpdGU6IFwia2V5d29yZFwiLFxuICBjb2RlOiBcIm1vbm9zcGFjZVwiLFxuICBkZWZpbml0aW9uTGlzdDogXCJsaXN0XCIsXG4gIGRlbGV0aW9uOiBcImRlbGV0ZWRcIixcbiAgZGl2OiBcInB1bmN0dWF0aW9uXCIsXG4gIGVtOiBcImVtcGhhc2lzXCIsXG4gIGZvb3Rub3RlOiBcInZhcmlhYmxlXCIsXG4gIGZvb3RDaXRlOiBcInF1YWxpZmllclwiLFxuICBoZWFkZXI6IFwiaGVhZGluZ1wiLFxuICBodG1sOiBcImNvbW1lbnRcIixcbiAgaW1hZ2U6IFwiYXRvbVwiLFxuICBpdGFsaWM6IFwiZW1waGFzaXNcIixcbiAgbGluazogXCJsaW5rXCIsXG4gIGxpbmtEZWZpbml0aW9uOiBcImxpbmtcIixcbiAgbGlzdDE6IFwibGlzdFwiLFxuICBsaXN0MjogXCJsaXN0LnNwZWNpYWxcIixcbiAgbGlzdDM6IFwibGlzdFwiLFxuICBub3RleHRpbGU6IFwic3RyaW5nLnNwZWNpYWxcIixcbiAgcHJlOiBcIm9wZXJhdG9yXCIsXG4gIHA6IFwiY29udGVudFwiLFxuICBxdW90ZTogXCJicmFja2V0XCIsXG4gIHNwYW46IFwicXVvdGVcIixcbiAgc3BlY2lhbENoYXI6IFwiY2hhcmFjdGVyXCIsXG4gIHN0cm9uZzogXCJzdHJvbmdcIixcbiAgc3ViOiBcImNvbnRlbnQuc3BlY2lhbFwiLFxuICBzdXA6IFwiY29udGVudC5zcGVjaWFsXCIsXG4gIHRhYmxlOiBcInZhcmlhYmxlTmFtZS5zcGVjaWFsXCIsXG4gIHRhYmxlSGVhZGluZzogXCJvcGVyYXRvclwiXG59O1xuXG5mdW5jdGlvbiBzdGFydE5ld0xpbmUoc3RyZWFtLCBzdGF0ZSkge1xuICBzdGF0ZS5tb2RlID0gTW9kZXMubmV3TGF5b3V0O1xuICBzdGF0ZS50YWJsZUhlYWRpbmcgPSBmYWxzZTtcblxuICBpZiAoc3RhdGUubGF5b3V0VHlwZSA9PT0gXCJkZWZpbml0aW9uTGlzdFwiICYmIHN0YXRlLnNwYW5uaW5nTGF5b3V0ICYmXG4gICAgICBzdHJlYW0ubWF0Y2goUkUoXCJkZWZpbml0aW9uTGlzdEVuZFwiKSwgZmFsc2UpKVxuICAgIHN0YXRlLnNwYW5uaW5nTGF5b3V0ID0gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIGNoKSB7XG4gIGlmIChjaCA9PT0gXCJfXCIpIHtcbiAgICBpZiAoc3RyZWFtLmVhdChcIl9cIikpXG4gICAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJpdGFsaWNcIiwgL19fLywgMik7XG4gICAgZWxzZVxuICAgICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwiZW1cIiwgL18vLCAxKTtcbiAgfVxuXG4gIGlmIChjaCA9PT0gXCIqXCIpIHtcbiAgICBpZiAoc3RyZWFtLmVhdChcIipcIikpIHtcbiAgICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcImJvbGRcIiwgL1xcKlxcKi8sIDIpO1xuICAgIH1cbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJzdHJvbmdcIiwgL1xcKi8sIDEpO1xuICB9XG5cbiAgaWYgKGNoID09PSBcIltcIikge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goL1xcZCtcXF0vKSkgc3RhdGUuZm9vdENpdGUgPSB0cnVlO1xuICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH1cblxuICBpZiAoY2ggPT09IFwiKFwiKSB7XG4gICAgdmFyIHNwZWMgPSBzdHJlYW0ubWF0Y2goL14ocnx0bXxjKVxcKS8pO1xuICAgIGlmIChzcGVjKVxuICAgICAgcmV0dXJuIFRPS0VOX1NUWUxFUy5zcGVjaWFsQ2hhclxuICB9XG5cbiAgaWYgKGNoID09PSBcIjxcIiAmJiBzdHJlYW0ubWF0Y2goLyhcXHcrKVtePl0rPltePF0rPFxcL1xcMT4vKSlcbiAgICByZXR1cm4gVE9LRU5fU1RZTEVTLmh0bWxcblxuICBpZiAoY2ggPT09IFwiP1wiICYmIHN0cmVhbS5lYXQoXCI/XCIpKVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcImNpdGVcIiwgL1xcP1xcPy8sIDIpO1xuXG4gIGlmIChjaCA9PT0gXCI9XCIgJiYgc3RyZWFtLmVhdChcIj1cIikpXG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwibm90ZXh0aWxlXCIsIC89PS8sIDIpO1xuXG4gIGlmIChjaCA9PT0gXCItXCIgJiYgIXN0cmVhbS5lYXQoXCItXCIpKVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcImRlbGV0aW9uXCIsIC8tLywgMSk7XG5cbiAgaWYgKGNoID09PSBcIitcIilcbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJhZGRpdGlvblwiLCAvXFwrLywgMSk7XG5cbiAgaWYgKGNoID09PSBcIn5cIilcbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJzdWJcIiwgL34vLCAxKTtcblxuICBpZiAoY2ggPT09IFwiXlwiKVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcInN1cFwiLCAvXFxeLywgMSk7XG5cbiAgaWYgKGNoID09PSBcIiVcIilcbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJzcGFuXCIsIC8lLywgMSk7XG5cbiAgaWYgKGNoID09PSBcIkBcIilcbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJjb2RlXCIsIC9ALywgMSk7XG5cbiAgaWYgKGNoID09PSBcIiFcIikge1xuICAgIHZhciB0eXBlID0gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJpbWFnZVwiLCAvKD86XFwoW15cXCldK1xcKSk/IS8sIDEpO1xuICAgIHN0cmVhbS5tYXRjaCgvXjpcXFMrLyk7IC8vIG9wdGlvbmFsIFVybCBwb3J0aW9uXG4gICAgcmV0dXJuIHR5cGU7XG4gIH1cbiAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgcGhyYXNlTW9kaWZpZXIsIGNsb3NlUkUsIG9wZW5TaXplKSB7XG4gIHZhciBjaGFyQmVmb3JlID0gc3RyZWFtLnBvcyA+IG9wZW5TaXplID8gc3RyZWFtLnN0cmluZy5jaGFyQXQoc3RyZWFtLnBvcyAtIG9wZW5TaXplIC0gMSkgOiBudWxsO1xuICB2YXIgY2hhckFmdGVyID0gc3RyZWFtLnBlZWsoKTtcbiAgaWYgKHN0YXRlW3BocmFzZU1vZGlmaWVyXSkge1xuICAgIGlmICgoIWNoYXJBZnRlciB8fCAvXFxXLy50ZXN0KGNoYXJBZnRlcikpICYmIGNoYXJCZWZvcmUgJiYgL1xcUy8udGVzdChjaGFyQmVmb3JlKSkge1xuICAgICAgdmFyIHR5cGUgPSB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gICAgICBzdGF0ZVtwaHJhc2VNb2RpZmllcl0gPSBmYWxzZTtcbiAgICAgIHJldHVybiB0eXBlO1xuICAgIH1cbiAgfSBlbHNlIGlmICgoIWNoYXJCZWZvcmUgfHwgL1xcVy8udGVzdChjaGFyQmVmb3JlKSkgJiYgY2hhckFmdGVyICYmIC9cXFMvLnRlc3QoY2hhckFmdGVyKSAmJlxuICAgICAgICAgICAgIHN0cmVhbS5tYXRjaChuZXcgUmVnRXhwKFwiXi4qXFxcXFNcIiArIGNsb3NlUkUuc291cmNlICsgXCIoPzpcXFxcV3wkKVwiKSwgZmFsc2UpKSB7XG4gICAgc3RhdGVbcGhyYXNlTW9kaWZpZXJdID0gdHJ1ZTtcbiAgICBzdGF0ZS5tb2RlID0gTW9kZXMuYXR0cmlidXRlcztcbiAgfVxuICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xufTtcblxuZnVuY3Rpb24gdG9rZW5TdHlsZXMoc3RhdGUpIHtcbiAgdmFyIGRpc2FibGVkID0gdGV4dGlsZURpc2FibGVkKHN0YXRlKTtcbiAgaWYgKGRpc2FibGVkKSByZXR1cm4gZGlzYWJsZWQ7XG5cbiAgdmFyIHN0eWxlcyA9IFtdO1xuICBpZiAoc3RhdGUubGF5b3V0VHlwZSkgc3R5bGVzLnB1c2goVE9LRU5fU1RZTEVTW3N0YXRlLmxheW91dFR5cGVdKTtcblxuICBzdHlsZXMgPSBzdHlsZXMuY29uY2F0KGFjdGl2ZVN0eWxlcyhcbiAgICBzdGF0ZSwgXCJhZGRpdGlvblwiLCBcImJvbGRcIiwgXCJjaXRlXCIsIFwiY29kZVwiLCBcImRlbGV0aW9uXCIsIFwiZW1cIiwgXCJmb290Q2l0ZVwiLFxuICAgIFwiaW1hZ2VcIiwgXCJpdGFsaWNcIiwgXCJsaW5rXCIsIFwic3BhblwiLCBcInN0cm9uZ1wiLCBcInN1YlwiLCBcInN1cFwiLCBcInRhYmxlXCIsIFwidGFibGVIZWFkaW5nXCIpKTtcblxuICBpZiAoc3RhdGUubGF5b3V0VHlwZSA9PT0gXCJoZWFkZXJcIilcbiAgICBzdHlsZXMucHVzaChUT0tFTl9TVFlMRVMuaGVhZGVyICsgXCItXCIgKyBzdGF0ZS5oZWFkZXIpO1xuXG4gIHJldHVybiBzdHlsZXMubGVuZ3RoID8gc3R5bGVzLmpvaW4oXCIgXCIpIDogbnVsbDtcbn1cblxuZnVuY3Rpb24gdGV4dGlsZURpc2FibGVkKHN0YXRlKSB7XG4gIHZhciB0eXBlID0gc3RhdGUubGF5b3V0VHlwZTtcblxuICBzd2l0Y2godHlwZSkge1xuICBjYXNlIFwibm90ZXh0aWxlXCI6XG4gIGNhc2UgXCJjb2RlXCI6XG4gIGNhc2UgXCJwcmVcIjpcbiAgICByZXR1cm4gVE9LRU5fU1RZTEVTW3R5cGVdO1xuICBkZWZhdWx0OlxuICAgIGlmIChzdGF0ZS5ub3RleHRpbGUpXG4gICAgICByZXR1cm4gVE9LRU5fU1RZTEVTLm5vdGV4dGlsZSArICh0eXBlID8gKFwiIFwiICsgVE9LRU5fU1RZTEVTW3R5cGVdKSA6IFwiXCIpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFjdGl2ZVN0eWxlcyhzdGF0ZSkge1xuICB2YXIgc3R5bGVzID0gW107XG4gIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgaWYgKHN0YXRlW2FyZ3VtZW50c1tpXV0pXG4gICAgICBzdHlsZXMucHVzaChUT0tFTl9TVFlMRVNbYXJndW1lbnRzW2ldXSk7XG4gIH1cbiAgcmV0dXJuIHN0eWxlcztcbn1cblxuZnVuY3Rpb24gYmxhbmtMaW5lKHN0YXRlKSB7XG4gIHZhciBzcGFubmluZ0xheW91dCA9IHN0YXRlLnNwYW5uaW5nTGF5b3V0LCB0eXBlID0gc3RhdGUubGF5b3V0VHlwZTtcblxuICBmb3IgKHZhciBrZXkgaW4gc3RhdGUpIGlmIChzdGF0ZS5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgIGRlbGV0ZSBzdGF0ZVtrZXldO1xuXG4gIHN0YXRlLm1vZGUgPSBNb2Rlcy5uZXdMYXlvdXQ7XG4gIGlmIChzcGFubmluZ0xheW91dCkge1xuICAgIHN0YXRlLmxheW91dFR5cGUgPSB0eXBlO1xuICAgIHN0YXRlLnNwYW5uaW5nTGF5b3V0ID0gdHJ1ZTtcbiAgfVxufVxuXG52YXIgUkVzID0ge1xuICBjYWNoZToge30sXG4gIHNpbmdsZToge1xuICAgIGJjOiBcImJjXCIsXG4gICAgYnE6IFwiYnFcIixcbiAgICBkZWZpbml0aW9uTGlzdDogLy0gLio/Oj0rLyxcbiAgICBkZWZpbml0aW9uTGlzdEVuZDogLy4qPTpcXHMqJC8sXG4gICAgZGl2OiBcImRpdlwiLFxuICAgIGRyYXdUYWJsZTogL1xcfC4qXFx8LyxcbiAgICBmb290OiAvZm5cXGQrLyxcbiAgICBoZWFkZXI6IC9oWzEtNl0vLFxuICAgIGh0bWw6IC9cXHMqPCg/OlxcLyk/KFxcdyspKD86W14+XSspPz4oPzpbXjxdKzxcXC9cXDE+KT8vLFxuICAgIGxpbms6IC9bXlwiXStcIjpcXFMvLFxuICAgIGxpbmtEZWZpbml0aW9uOiAvXFxbW15cXHNcXF1dK1xcXVxcUysvLFxuICAgIGxpc3Q6IC8oPzojK3xcXCorKS8sXG4gICAgbm90ZXh0aWxlOiBcIm5vdGV4dGlsZVwiLFxuICAgIHBhcmE6IFwicFwiLFxuICAgIHByZTogXCJwcmVcIixcbiAgICB0YWJsZTogXCJ0YWJsZVwiLFxuICAgIHRhYmxlQ2VsbEF0dHJpYnV0ZXM6IC9bXFwvXFxcXF1cXGQrLyxcbiAgICB0YWJsZUhlYWRpbmc6IC9cXHxfXFwuLyxcbiAgICB0YWJsZVRleHQ6IC9bXlwiX1xcKlxcW1xcKFxcP1xcK35cXF4lQHwtXSsvLFxuICAgIHRleHQ6IC9bXiFcIl89XFwqXFxbXFwoPFxcP1xcK35cXF4lQC1dKy9cbiAgfSxcbiAgYXR0cmlidXRlczoge1xuICAgIGFsaWduOiAvKD86PD58PHw+fD0pLyxcbiAgICBzZWxlY3RvcjogL1xcKFteXFwoXVteXFwpXStcXCkvLFxuICAgIGxhbmc6IC9cXFtbXlxcW1xcXV0rXFxdLyxcbiAgICBwYWQ6IC8oPzpcXCgrfFxcKSspezEsMn0vLFxuICAgIGNzczogL1xce1teXFx9XStcXH0vXG4gIH0sXG4gIGNyZWF0ZVJlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgc3dpdGNoIChuYW1lKSB7XG4gICAgY2FzZSBcImRyYXdUYWJsZVwiOlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFcy5zaW5nbGUuZHJhd1RhYmxlLCBcIiRcIik7XG4gICAgY2FzZSBcImh0bWxcIjpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRXMuc2luZ2xlLmh0bWwsIFwiKD86XCIsIFJFcy5zaW5nbGUuaHRtbCwgXCIpKlwiLCBcIiRcIik7XG4gICAgY2FzZSBcImxpbmtEZWZpbml0aW9uXCI6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkVzLnNpbmdsZS5saW5rRGVmaW5pdGlvbiwgXCIkXCIpO1xuICAgIGNhc2UgXCJsaXN0TGF5b3V0XCI6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkVzLnNpbmdsZS5saXN0LCBSRShcImFsbEF0dHJpYnV0ZXNcIiksIFwiKlxcXFxzK1wiKTtcbiAgICBjYXNlIFwidGFibGVDZWxsQXR0cmlidXRlc1wiOlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFcy5jaG9pY2VSZShSRXMuc2luZ2xlLnRhYmxlQ2VsbEF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSRShcImFsbEF0dHJpYnV0ZXNcIikpLCBcIitcXFxcLlwiKTtcbiAgICBjYXNlIFwidHlwZVwiOlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFKFwiYWxsVHlwZXNcIikpO1xuICAgIGNhc2UgXCJ0eXBlTGF5b3V0XCI6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkUoXCJhbGxUeXBlc1wiKSwgUkUoXCJhbGxBdHRyaWJ1dGVzXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCIqXFxcXC5cXFxcLj9cIiwgXCIoXFxcXHMrfCQpXCIpO1xuICAgIGNhc2UgXCJhdHRyaWJ1dGVzXCI6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkUoXCJhbGxBdHRyaWJ1dGVzXCIpLCBcIitcIik7XG5cbiAgICBjYXNlIFwiYWxsVHlwZXNcIjpcbiAgICAgIHJldHVybiBSRXMuY2hvaWNlUmUoUkVzLnNpbmdsZS5kaXYsIFJFcy5zaW5nbGUuZm9vdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgUkVzLnNpbmdsZS5oZWFkZXIsIFJFcy5zaW5nbGUuYmMsIFJFcy5zaW5nbGUuYnEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFJFcy5zaW5nbGUubm90ZXh0aWxlLCBSRXMuc2luZ2xlLnByZSwgUkVzLnNpbmdsZS50YWJsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgUkVzLnNpbmdsZS5wYXJhKTtcblxuICAgIGNhc2UgXCJhbGxBdHRyaWJ1dGVzXCI6XG4gICAgICByZXR1cm4gUkVzLmNob2ljZVJlKFJFcy5hdHRyaWJ1dGVzLnNlbGVjdG9yLCBSRXMuYXR0cmlidXRlcy5jc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFJFcy5hdHRyaWJ1dGVzLmxhbmcsIFJFcy5hdHRyaWJ1dGVzLmFsaWduLCBSRXMuYXR0cmlidXRlcy5wYWQpO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRXMuc2luZ2xlW25hbWVdKTtcbiAgICB9XG4gIH0sXG4gIG1ha2VSZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhdHRlcm4gPSBcIlwiO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgYXJnID0gYXJndW1lbnRzW2ldO1xuICAgICAgcGF0dGVybiArPSAodHlwZW9mIGFyZyA9PT0gXCJzdHJpbmdcIikgPyBhcmcgOiBhcmcuc291cmNlO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFJlZ0V4cChwYXR0ZXJuKTtcbiAgfSxcbiAgY2hvaWNlUmU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwYXJ0cyA9IFthcmd1bWVudHNbMF1dO1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICBwYXJ0c1tpICogMiAtIDFdID0gXCJ8XCI7XG4gICAgICBwYXJ0c1tpICogMl0gPSBhcmd1bWVudHNbaV07XG4gICAgfVxuXG4gICAgcGFydHMudW5zaGlmdChcIig/OlwiKTtcbiAgICBwYXJ0cy5wdXNoKFwiKVwiKTtcbiAgICByZXR1cm4gUkVzLm1ha2VSZS5hcHBseShudWxsLCBwYXJ0cyk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIFJFKG5hbWUpIHtcbiAgcmV0dXJuIChSRXMuY2FjaGVbbmFtZV0gfHwgKFJFcy5jYWNoZVtuYW1lXSA9IFJFcy5jcmVhdGVSZShuYW1lKSkpO1xufVxuXG52YXIgTW9kZXMgPSB7XG4gIG5ld0xheW91dDogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJ0eXBlTGF5b3V0XCIpLCBmYWxzZSkpIHtcbiAgICAgIHN0YXRlLnNwYW5uaW5nTGF5b3V0ID0gZmFsc2U7XG4gICAgICByZXR1cm4gKHN0YXRlLm1vZGUgPSBNb2Rlcy5ibG9ja1R5cGUpKHN0cmVhbSwgc3RhdGUpO1xuICAgIH1cbiAgICB2YXIgbmV3TW9kZTtcbiAgICBpZiAoIXRleHRpbGVEaXNhYmxlZChzdGF0ZSkpIHtcbiAgICAgIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJsaXN0TGF5b3V0XCIpLCBmYWxzZSkpXG4gICAgICAgIG5ld01vZGUgPSBNb2Rlcy5saXN0O1xuICAgICAgZWxzZSBpZiAoc3RyZWFtLm1hdGNoKFJFKFwiZHJhd1RhYmxlXCIpLCBmYWxzZSkpXG4gICAgICAgIG5ld01vZGUgPSBNb2Rlcy50YWJsZTtcbiAgICAgIGVsc2UgaWYgKHN0cmVhbS5tYXRjaChSRShcImxpbmtEZWZpbml0aW9uXCIpLCBmYWxzZSkpXG4gICAgICAgIG5ld01vZGUgPSBNb2Rlcy5saW5rRGVmaW5pdGlvbjtcbiAgICAgIGVsc2UgaWYgKHN0cmVhbS5tYXRjaChSRShcImRlZmluaXRpb25MaXN0XCIpKSlcbiAgICAgICAgbmV3TW9kZSA9IE1vZGVzLmRlZmluaXRpb25MaXN0O1xuICAgICAgZWxzZSBpZiAoc3RyZWFtLm1hdGNoKFJFKFwiaHRtbFwiKSwgZmFsc2UpKVxuICAgICAgICBuZXdNb2RlID0gTW9kZXMuaHRtbDtcbiAgICB9XG4gICAgcmV0dXJuIChzdGF0ZS5tb2RlID0gKG5ld01vZGUgfHwgTW9kZXMudGV4dCkpKHN0cmVhbSwgc3RhdGUpO1xuICB9LFxuXG4gIGJsb2NrVHlwZTogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIHZhciBtYXRjaCwgdHlwZTtcbiAgICBzdGF0ZS5sYXlvdXRUeXBlID0gbnVsbDtcblxuICAgIGlmIChtYXRjaCA9IHN0cmVhbS5tYXRjaChSRShcInR5cGVcIikpKVxuICAgICAgdHlwZSA9IG1hdGNoWzBdO1xuICAgIGVsc2VcbiAgICAgIHJldHVybiAoc3RhdGUubW9kZSA9IE1vZGVzLnRleHQpKHN0cmVhbSwgc3RhdGUpO1xuXG4gICAgaWYgKG1hdGNoID0gdHlwZS5tYXRjaChSRShcImhlYWRlclwiKSkpIHtcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcImhlYWRlclwiO1xuICAgICAgc3RhdGUuaGVhZGVyID0gcGFyc2VJbnQobWF0Y2hbMF1bMV0pO1xuICAgIH0gZWxzZSBpZiAodHlwZS5tYXRjaChSRShcImJxXCIpKSkge1xuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwicXVvdGVcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGUubWF0Y2goUkUoXCJiY1wiKSkpIHtcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcImNvZGVcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGUubWF0Y2goUkUoXCJmb290XCIpKSkge1xuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwiZm9vdG5vdGVcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGUubWF0Y2goUkUoXCJub3RleHRpbGVcIikpKSB7XG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJub3RleHRpbGVcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGUubWF0Y2goUkUoXCJwcmVcIikpKSB7XG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJwcmVcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGUubWF0Y2goUkUoXCJkaXZcIikpKSB7XG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJkaXZcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGUubWF0Y2goUkUoXCJ0YWJsZVwiKSkpIHtcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcInRhYmxlXCI7XG4gICAgfVxuXG4gICAgc3RhdGUubW9kZSA9IE1vZGVzLmF0dHJpYnV0ZXM7XG4gICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfSxcblxuICB0ZXh0OiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHN0cmVhbS5tYXRjaChSRShcInRleHRcIikpKSByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuXG4gICAgdmFyIGNoID0gc3RyZWFtLm5leHQoKTtcbiAgICBpZiAoY2ggPT09ICdcIicpXG4gICAgICByZXR1cm4gKHN0YXRlLm1vZGUgPSBNb2Rlcy5saW5rKShzdHJlYW0sIHN0YXRlKTtcbiAgICByZXR1cm4gaGFuZGxlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgY2gpO1xuICB9LFxuXG4gIGF0dHJpYnV0ZXM6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBzdGF0ZS5tb2RlID0gTW9kZXMubGF5b3V0TGVuZ3RoO1xuXG4gICAgaWYgKHN0cmVhbS5tYXRjaChSRShcImF0dHJpYnV0ZXNcIikpKVxuICAgICAgcmV0dXJuIFRPS0VOX1NUWUxFUy5hdHRyaWJ1dGVzXG4gICAgZWxzZVxuICAgICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfSxcblxuICBsYXlvdXRMZW5ndGg6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAoc3RyZWFtLmVhdChcIi5cIikgJiYgc3RyZWFtLmVhdChcIi5cIikpXG4gICAgICBzdGF0ZS5zcGFubmluZ0xheW91dCA9IHRydWU7XG5cbiAgICBzdGF0ZS5tb2RlID0gTW9kZXMudGV4dDtcbiAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9LFxuXG4gIGxpc3Q6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICB2YXIgbWF0Y2ggPSBzdHJlYW0ubWF0Y2goUkUoXCJsaXN0XCIpKTtcbiAgICBzdGF0ZS5saXN0RGVwdGggPSBtYXRjaFswXS5sZW5ndGg7XG4gICAgdmFyIGxpc3RNb2QgPSAoc3RhdGUubGlzdERlcHRoIC0gMSkgJSAzO1xuICAgIGlmICghbGlzdE1vZClcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcImxpc3QxXCI7XG4gICAgZWxzZSBpZiAobGlzdE1vZCA9PT0gMSlcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcImxpc3QyXCI7XG4gICAgZWxzZVxuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwibGlzdDNcIjtcblxuICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy5hdHRyaWJ1dGVzO1xuICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH0sXG5cbiAgbGluazogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy50ZXh0O1xuICAgIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJsaW5rXCIpKSkge1xuICAgICAgc3RyZWFtLm1hdGNoKC9cXFMrLyk7XG4gICAgICByZXR1cm4gVE9LRU5fU1RZTEVTLmxpbmtcbiAgICB9XG4gICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfSxcblxuICBsaW5rRGVmaW5pdGlvbjogZnVuY3Rpb24oc3RyZWFtKSB7XG4gICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgIHJldHVybiBUT0tFTl9TVFlMRVMubGlua0RlZmluaXRpb25cbiAgfSxcblxuICBkZWZpbml0aW9uTGlzdDogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIHN0cmVhbS5tYXRjaChSRShcImRlZmluaXRpb25MaXN0XCIpKTtcblxuICAgIHN0YXRlLmxheW91dFR5cGUgPSBcImRlZmluaXRpb25MaXN0XCI7XG5cbiAgICBpZiAoc3RyZWFtLm1hdGNoKC9cXHMqJC8pKVxuICAgICAgc3RhdGUuc3Bhbm5pbmdMYXlvdXQgPSB0cnVlO1xuICAgIGVsc2VcbiAgICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy5hdHRyaWJ1dGVzO1xuXG4gICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfSxcblxuICBodG1sOiBmdW5jdGlvbihzdHJlYW0pIHtcbiAgICBzdHJlYW0uc2tpcFRvRW5kKCk7XG4gICAgcmV0dXJuIFRPS0VOX1NUWUxFUy5odG1sXG4gIH0sXG5cbiAgdGFibGU6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJ0YWJsZVwiO1xuICAgIHJldHVybiAoc3RhdGUubW9kZSA9IE1vZGVzLnRhYmxlQ2VsbCkoc3RyZWFtLCBzdGF0ZSk7XG4gIH0sXG5cbiAgdGFibGVDZWxsOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHN0cmVhbS5tYXRjaChSRShcInRhYmxlSGVhZGluZ1wiKSkpXG4gICAgICBzdGF0ZS50YWJsZUhlYWRpbmcgPSB0cnVlO1xuICAgIGVsc2VcbiAgICAgIHN0cmVhbS5lYXQoXCJ8XCIpO1xuXG4gICAgc3RhdGUubW9kZSA9IE1vZGVzLnRhYmxlQ2VsbEF0dHJpYnV0ZXM7XG4gICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfSxcblxuICB0YWJsZUNlbGxBdHRyaWJ1dGVzOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgc3RhdGUubW9kZSA9IE1vZGVzLnRhYmxlVGV4dDtcblxuICAgIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJ0YWJsZUNlbGxBdHRyaWJ1dGVzXCIpKSlcbiAgICAgIHJldHVybiBUT0tFTl9TVFlMRVMuYXR0cmlidXRlc1xuICAgIGVsc2VcbiAgICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH0sXG5cbiAgdGFibGVUZXh0OiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHN0cmVhbS5tYXRjaChSRShcInRhYmxlVGV4dFwiKSkpXG4gICAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuXG4gICAgaWYgKHN0cmVhbS5wZWVrKCkgPT09IFwifFwiKSB7IC8vIGVuZCBvZiBjZWxsXG4gICAgICBzdGF0ZS5tb2RlID0gTW9kZXMudGFibGVDZWxsO1xuICAgICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgICB9XG4gICAgcmV0dXJuIGhhbmRsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIHN0cmVhbS5uZXh0KCkpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgdGV4dGlsZSA9IHtcbiAgc3RhcnRTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHsgbW9kZTogTW9kZXMubmV3TGF5b3V0IH07XG4gIH0sXG4gIHRva2VuOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHN0cmVhbS5zb2woKSkgc3RhcnROZXdMaW5lKHN0cmVhbSwgc3RhdGUpO1xuICAgIHJldHVybiBzdGF0ZS5tb2RlKHN0cmVhbSwgc3RhdGUpO1xuICB9LFxuICBibGFua0xpbmU6IGJsYW5rTGluZVxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==